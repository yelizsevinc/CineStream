@page "/shows"
@using Microsoft.EntityFrameworkCore
@using CineStream.Data

@inject IDbContextFactory<CineStreamContext> DbFactory

<PageTitle>Shows</PageTitle>

<Tabs>
    <Tab>
        <Header>Shows</Header>
        <ChildContent>
            @if (AppShows != null)
            {
                <Datagrid Items="AppShows">
                    <DatagridColumn Title="ShowId" TRowData="Show" Field="c => c.ShowId" CanSort="true" CanFilter="true"
                        FilterImmediately="true" />
                    <DatagridColumn Title="Title" TRowData="Show" Field="c => c.Title" CanSort="true" CanFilter="true"
                        FilterImmediately="true" />
                    <DatagridColumn Title="CreatedAt" TRowData="Show" Field="c => c.CreatedAt.ToString()" CanSort="true"
                        CanFilter="true" FilterImmediately="true" />
                </Datagrid>
            }
        </ChildContent>
    </Tab>
</Tabs>

@code {
    private ICollection<Show>? AppShows { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await LoadDataAsync();
    }

    private async Task LoadDataAsync()
    {
        using var context = DbFactory.CreateDbContext();

        AppShows = await context.Shows!.ToListAsync();

    }
}
